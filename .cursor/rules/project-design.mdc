---
description: Whenever you need to know -  what is bieng build, check project road map, project goal
alwaysApply: false
---


NOTE: THIS IS A FLEXIBLE PLAN DESIGNED TO GIVE A ROUGH/FIRST DRAFT PLAN FOR THIS PROJECT; Language - TypeScript

ğŸ—ï¸ Project: Scalable Realtime Subscription Gateway
ğŸ”¥ Goal
Build a backend system that:

Accepts live event updates from producers (e.g., doc edits, presence updates)

Delivers those updates in real-time to thousands of WebSocket subscribers

Handles backpressure, slow clients, fan-out, durability, and rate limiting

Uses Redis, GraphQL, and Firebase Auth to manage all this at scale

ğŸ§  Core Concepts Youâ€™ll Build
Area	Component
Ingress	Producers send events (via REST or GraphQL Mutation)
Message Broker	Redis Pub/Sub (for low-latency fan-out), optionally Redis Streams
Subscription Layer	GraphQL Subscriptions over WebSocket
Fan-Out Logic	Per-topic ring buffers, subscriber queues, coalescing, slow detection
Rate Limiting	Token buckets via Redis Lua
Resync / Snapshots	Optional: Redis Streams + Firestore snapshot store
Auth	Firebase Auth on connection, topic ACL checks
Observability	Metrics for topic pressure, client lag, event drop rates

ğŸ§± Tech Stack
Tool	Use
Redis	Pub/Sub + optional Streams + token bucket rate limiting
Apollo Server or Envelop	GraphQL API Gateway (subscriptions + mutations)
graphql-ws	WebSocket protocol for real-time GraphQL
Firebase Auth	Authentication (JWT validation)
Firestore	Store topic metadata and optional snapshots
TypeScript / Node.js	Clean typed backend with Cursor agent support

ğŸ§° Project Structure
bash
Copy
Edit
realtime-gateway/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts             # Entry point
â”‚   â”œâ”€â”€ gateway/
â”‚   â”‚   â”œâ”€â”€ subscriptionServer.ts  # GraphQL WS handlers
â”‚   â”‚   â”œâ”€â”€ topicManager.ts        # Per-topic buffers, dispatch
â”‚   â”‚   â”œâ”€â”€ subscriber.ts          # Subscriber queues & lifecycle
â”‚   â”‚   â””â”€â”€ auth.ts                # Firebase Auth + ACL checks
â”‚   â”œâ”€â”€ redis/
â”‚   â”‚   â”œâ”€â”€ pubsub.ts        # Redis Pub/Sub handlers
â”‚   â”‚   â”œâ”€â”€ streams.ts       # Optional durable stream ingestion
â”‚   â”‚   â”œâ”€â”€ ratelimit.ts     # Lua token bucket logic
â”‚   â”œâ”€â”€ graphql/
â”‚   â”‚   â”œâ”€â”€ schema.ts        # GraphQL schema definitions
â”‚   â”‚   â””â”€â”€ resolvers.ts     # publishEvent, etc.
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ logger.ts        # Winston or pino-based logging
â”‚   â””â”€â”€ config.ts            # Env config
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ seedTopics.ts        # Local topic setup for dev
â”œâ”€â”€ docker-compose.yml       # Redis cluster, gateway service
â”œâ”€â”€ .env
â””â”€â”€ README.md
ğŸ—ºï¸ Feature Development Plan (Coding Agents Ready)
âœ… Phase 1: Basic Fan-Out MVP (0â€“2 weeks)
Goal: get real-time updates from producers â†’ subscribers

 Create minimal GraphQL schema with:

publishEvent(topicId, event)

subscription topicEvents(topicId)

 Firebase Auth JWT parsing & validation middleware

 Redis Pub/Sub listener per topic

 In-memory per-topic ring buffer (ArrayDeque or RingBuffer class)

 Simple in-memory per-subscriber queues

 Dispatch loop with fair delivery

Bonus:

 CLI client: ws://localhost:4000/graphql that prints events

ğŸš¦ Phase 2: Backpressure + Slow Client Handling (3â€“4 weeks)
 Detect full subscriber queues

 Coalescing: only send last presence update if backlogged

 Drop strategy: kick clients who fall too far behind

 Topic snapshots (just JSON) for resync fallback

ğŸ”’ Phase 3: Rate Limits + Security
 Redis Lua script for token bucket (per topic/tenant)

 Deny publishEvent if over limit

 GraphQL auth rules: check topic-level ACL (user â†’ Firestore)

ğŸ“ˆ Phase 4: Observability
 Expose /metrics (Prometheus)

topic buffer fill %

subscriber lag

event drops / kicks

 Structured logs: event publish, dispatch, kick reasons

ğŸ§± Phase 5: Durable Streams & Replay (Optional)
 On publishEvent, push to stream:topicId

 On reconnect, allow fromSeq param

 Replay from Redis Stream + skip to latest

ğŸ“š Firebase Integration Plan
Feature	Use
Firebase Auth	Validate JWT from WebSocket handshake or mutation headers
Firestore	Store topics/{topicId} metadata like access rules, snapshot pointers
Firebase Admin SDK	Use for token verification + Firestore reads

ğŸ“¦ MVP Deliverables
âœ… yarn dev spins up local gateway + Redis

âœ… publishEvent(topic, {type, data}) sends to all subscribers

âœ… Real-time WebSocket clients receive events

âœ… Firebase-authenticated connections

âœ… CLI to simulate producers and clients